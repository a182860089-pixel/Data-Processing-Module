# 无分页模式使用说明

## 功能介绍

新增了 `no_pagination_and_metadata` 选项,用于生成无分页、无元数据的连续Markdown文档。

### 主要特性

1. **去除元数据头部** - 不包含YAML front matter
2. **去除页面标记** - 不包含 `<!-- Page x (ChunkType.TEXT) -->` 注释
3. **去除分隔符** - 不包含页面之间的 `---` 分隔线
4. **智能内容拼接** - 根据句尾标点自动决定是否添加换行

## 智能拼接规则

- 如果页面末尾字符是 **句号标点** (`.` `!` `?` `。` `!` `?`),则在拼接下一页内容前添加一个换行符
- 如果页面末尾字符**不是句号标点**,则直接拼接下一页内容(无换行)

## 使用方法

### 1. cURL 示例

```bash
# 无分页模式
curl -X POST "http://localhost:8000/api/v1/convert" \
  -F "file=@example.pdf" \
  -F 'options={"no_pagination_and_metadata": true}'

# 带分页模式(默认)
curl -X POST "http://localhost:8000/api/v1/convert" \
  -F "file=@example.pdf" \
  -F 'options={"no_pagination_and_metadata": false}'
```

### 2. Python 示例

```python
import requests
import json

# 无分页模式
with open('example.pdf', 'rb') as f:
    files = {'file': f}
    data = {
        'options': json.dumps({
            'no_pagination_and_metadata': True
        })
    }
    response = requests.post('http://localhost:8000/api/v1/convert', files=files, data=data)
    result = response.json()
    print(result['markdown_content'])
```

### 3. JavaScript 示例

```javascript
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('options', JSON.stringify({
    no_pagination_and_metadata: true
}));

fetch('http://localhost:8000/api/v1/convert', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(result => {
    console.log(result.markdown_content);
});
```

## 参数说明

### ConvertOptions 参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `dpi` | int | 144 | 图像渲染DPI (72-300) |
| `include_metadata` | bool | true | 是否包含元数据 |
| `no_pagination_and_metadata` | bool | false | 是否启用无分页模式 |
| `max_pages` | int | 100 | 最大处理页数 |

### 参数优先级

- 当 `no_pagination_and_metadata=true` 时,会**自动忽略** `include_metadata` 参数
- 无分页模式会同时去除元数据、页面标记和分隔符

## 输出对比

### 带分页模式输出示例

```markdown
---
title: 
pages: 13
pdf_type: PDFType.TEXT
generated_at: 2025-11-14T23:52:34.768052
---

<!-- Page 1 (ChunkType.TEXT) -->

第一章 总则

第一条 为了规范学位授予工作...

---

<!-- Page 2 (ChunkType.TEXT) -->

第二条 国家实行学位制度...

---
```

### 无分页模式输出示例

```markdown
第一章 总则

第一条 为了规范学位授予工作...
第二条 国家实行学位制度...
```

## 测试结果

使用 13 页的测试PDF文件:

- **带分页模式**: 6152 字符, 244 行
- **无分页模式**: 5532 字符, 166 行

减少了约 **10%** 的文件大小和 **32%** 的行数。

## 适用场景

### 推荐使用无分页模式

- 需要连续阅读的文档
- 用于AI处理的文本(减少token消耗)
- 需要复制粘贴整段内容
- 不关心原始页码信息

### 推荐使用带分页模式

- 需要保留页码引用
- 需要定位原始PDF位置
- 需要文档元数据信息
- 多人协作需要统一页码

## 注意事项

1. **页码数字问题**: 如果PDF本身在每页开头包含页码数字,这些数字会被保留在输出中(这是PDF文本提取的结果,不是拼接逻辑的问题)

2. **段落识别**: 拼接逻辑基于句尾标点,如果PDF文本提取质量不佳,可能会影响拼接效果

3. **元数据丢失**: 无分页模式会完全去除文档元数据,如果需要保留标题、作者等信息,请使用带分页模式

## 测试脚本

项目根目录下的 `test_no_pagination.py` 可以用于测试两种模式的输出差异:

```bash
python test_no_pagination.py
```

该脚本会:
1. 检查服务是否运行
2. 分别测试带分页和无分页模式
3. 显示输出预览和对比结果
4. 验证无分页模式是否正确工作

